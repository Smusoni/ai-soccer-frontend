<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SkillzWithSyd – Prototype</title>
  
  <!-- Social & preview metadata -->
<meta name="theme-color" content="#0f0f0f" />
<meta property="og:type" content="website" />
<meta property="og:title" content="Ball Knowledge – AI Soccer Prototype" />
<meta property="og:description" content="Add players and preview AI-style analysis. Built by Ball Knowledge." />
<meta property="og:image" content="ball-knowledge-high-resolution-logo.png" />
<meta property="og:url" content="https://smusoni.github.io/ai-soccer-frontend/" />
<meta name="twitter:card" content="summary_large_image" />
  
  <!-- Favicon -->
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="site.webmanifest">

 <style>
  body {
    font-family: "Poppins", Arial, sans-serif;
    background: #0f0f0f;
    color: #fff;
    margin: 24px;
    max-width: 720px;
    line-height: 1.6;
  }
  h1 {
    margin: 10px 0;
    font-size: 2rem;
    color: #00ff88;
    text-shadow: 0 0 8px rgba(0, 255, 136, 0.5);
  }
  .card {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 12px;
    padding: 16px;
    margin: 12px 0;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
  }
  input, button {
    padding: 10px 12px;
    font-size: 16px;
    border-radius: 8px;
  }
  input {
    border: 1px solid rgba(255,255,255,0.2);
    background: rgba(255,255,255,0.1);
    color: #fff;
  }
  button {
    border: none;
    background: linear-gradient(90deg, #00aaff, #00ff88);
    color: #fff;
    cursor: pointer;
    transition: opacity 0.3s ease;
  }
  button:hover { opacity: 0.8; }
  ul { padding-left: 20px; }
  .row { display: flex; gap: 8px; }
  .muted { color: #aaa; font-size: 14px; }
  #msg { margin-top: 8px; }
  .error { color: #ff5555; }
  .ok { color: #00ff88; }
  img.logo {
    width: 180px;
    margin-bottom: 10px;
  }
   /* --- Splash / Intro --- */
#splash {
  position: fixed; inset: 0; z-index: 9999;
  display: flex; flex-direction: column; gap: 16px;
  align-items: center; justify-content: center;
  background: #0f0f0f;
}

#splash .logo {
  width: 160px; height: auto; opacity: 0.95;
}

#splash h1 {
  margin: 8px 0 0; font-size: 2.2rem; color: #00ff88;
  text-shadow: 0 0 12px rgba(0,255,136,0.55);
}

#splash p { color: #aaa; margin: 0; }

.spinner {
  width: 44px; height: 44px; border-radius: 50%;
  border: 3px solid rgba(255,255,255,0.15);
  border-top-color: #00aaff;
  animation: spin 0.9s linear infinite;
}

@keyframes spin { to { transform: rotate(360deg); } }

#splash.hide { animation: fadeout 500ms ease forwards; }
@keyframes fadeout { to { opacity: 0; visibility: hidden; } }
  .analysisBox {
  background: #111;
  border-radius: 10px;
  padding: 14px 18px;
  margin-top: 10px;
  line-height: 1.5;
  color: #eee;
  box-shadow: 0 0 15px rgba(0,255,100,0.15);
}

.analysisBox strong {
  color: #00ff99;
}
 
</style>

</head>
<body>
  <!-- Intro / Splash -->
<div id="splash">
  <img src="ball-knowledge-high-resolution-logo.png" alt="Ball Knowledge Logo" class="logo" />
  <h1>Ball Knowledge</h1>
  <p>Initializing AI… connecting to server</p>
  <div class="spinner"></div>
</div>
<!-- ======================= HERO (LOGGED-OUT) ======================= -->
<div id="hero" class="card" style="max-width:900px;margin:0 auto 16px; text-align:center; display:none;">
  <img src="ball-knowledge-high-resolution-logo.png" alt="Ball Knowledge" style="height:64px;margin-bottom:8px">
  <h1 style="margin:8px 0 4px">Ball Knowledge</h1>
  <p class="muted" style="margin:0 0 16px">
    Upload match clips → AI breaks down your game → drills & pro comps tailored to you.
  </p>

  <div id="authCard" class="card" style="max-width:720px;margin:12px auto 0;text-align:left">
    <h3>Sign in / Sign up</h3>
    <div class="row" style="gap:8px;flex-wrap:wrap">
      <input id="username" placeholder="Username" style="min-width:200px">
      <input id="password" type="password" placeholder="Password" style="min-width:200px">
      <button id="loginBtn">Login</button>
      <button id="signupBtn">Sign Up</button>
    </div>
    <p id="authMsg" class="muted" style="margin-top:6px"></p>
  </div>

  <div class="card" style="max-width:720px;margin:12px auto 0;text-align:left">
    <h3>What you’ll get</h3>
    <ul style="margin-left:16px">
      <li>Instant report: <em>Top skill, Needs work</em>, and <em>Suggested drills</em></li>
      <li>Smart <em>pro comparisons</em> that match your style</li>
      <li>Save your <em>profile (height, weight, foot, position, DOB)</em> for better recs</li>
      <li>History of analyses to track progress</li>
    </ul>
  </div>
</div>
<!-- ===================== WELCOME BAR (LOGGED-IN) =================== -->
<div id="welcomeBar" class="card" style="display:none; max-width:900px; margin:0 auto 8px;">
  <span id="welcomeText">Welcome!</span>
  <button id="logoutBtn" style="float:right">Logout</button>
</div>
  <img src="ball-knowledge-high-resolution-logo.png" alt="Ball Knowledge Logo" class="logo">
<h1>Ball Knowledge</h1>
<p class="muted">Analyze. Learn. Evolve.</p>
  <p id="welcomeMsg" class="muted"></p>

<!-- PROFILE CARD -->
<div class="card" id="profileCard" style="display:none">
  <h3>Player Profile</h3>
  <input id="height" type="number" placeholder="Height (cm)" />
  <input id="weight" type="number" placeholder="Weight (kg)" />
  <input id="foot" type="text" placeholder="Dominant Foot" />
  <input id="position" type="text" placeholder="Position" />
  <input id="dob" type="date" placeholder="Date of Birth" />
  <button id="saveProfileBtn">Save Profile</button>
  <p id="profileMsg" class="muted"></p>
</div>
  <div class="card">
    <h3>Add player</h3>
    <div class="row">
      <input id="name" placeholder="Player name" />
      <button id="addBtn">Add</button>
    </div>
    <div id="msg"></div>
  </div>

  <div class="card">
    <h3>Players</h3>
    <button id="refresh">Refresh list</button>
    <ul id="list"></ul>
  </div>
  <!-- ======================= DASHBOARD (LOGGED-IN) ====================== -->
<div id="dashboard" style="display:none">
  <!-- Analysis Card -->
<div class="card" id="analysisCard" style="display:none">
  <h3>AI Analysis</h3>
  <p class="muted">Performance breakdown & recommendations.</p>

  <div id="analysisResult" class="analysisBox">
    <p class="muted">Select a player to view their AI analysis.</p>
  </div>

  <button id="refreshAnalysis" style="margin-top:12px">Re-run Analysis</button>
</div>
  <!-- Attributes Card -->
<div class="card" id="attrCard" style="display:none;">
  <h3>Attributes</h3>
  <p class="muted">Adjust your current self-rating (0–100). Saved on this device for now.</p>

  <label>Pace <input type="range" id="attrPace" min="0" max="100" value="60" oninput="attrPaceVal.textContent=this.value"> <strong id="attrPaceVal">60</strong></label><br>
  <label>Technique <input type="range" id="attrTech" min="0" max="100" value="60" oninput="attrTechVal.textContent=this.value"> <strong id="attrTechVal">60</strong></label><br>
  <label>Awareness <input type="range" id="attrAware" min="0" max="100" value="60" oninput="attrAwareVal.textContent=this.value"> <strong id="attrAwareVal">60</strong></label><br>
  <label>Composure <input type="range" id="attrComp" min="0" max="100" value="60" oninput="attrCompVal.textContent=this.value"> <strong id="attrCompVal">60</strong></label><br>

  <button id="saveAttrs" style="margin-top:10px">Save attributes</button>
  <p id="attrMsg" class="muted" style="margin-top:6px"></p>
</div>
  <!-- Clips Card -->
<div class="card" id="clipsCard" style="display:none;">
  <h3>Clips</h3>
  <p class="muted">Uploaded clips for the selected player.</p>
  <ul id="clipList"></ul>
</div>
  <!-- === Upload Video Clip === -->
<div class="row" style="margin-top:12px">
  <input id="clipFile" type="file" accept="video/*" />
  <button id="uploadBtn">Upload clip</button>
</div>
<p id="uploadMsg" class="muted" style="margin-top:6px"></p>
<!-- Optional video preview -->
<div id="videoPreview" style="display:none; margin-top:10px;">
  <h4>Uploaded Clip Preview:</h4>
  <video id="previewPlayer" controls width="320"></video>
</div>
  <!-- Upload Footage Card -->
<div class="card" id="uploadCard">
  <h3>Upload Player Footage</h3>
  <p class="muted">Upload a short clip (max 60s). Accepted formats: MP4, MOV, WEBM.</p>
  <input type="file" id="fileInput" accept="video/*,image/*">
  <button id="uploadBtn">Upload</button>
  <p id="uploadMsg" class="muted"></p>
</div>
  <!-- Upload Player Clip -->
<div class="card" id="uploadCard" style="display:none; margin-top:12px;">
  <h3>Upload Player Clip</h3>
  <input id="clipFile" type="file" accept="video/*" />
  <button id="uploadBtn">Upload clip</button>
  <p id="uploadMsg" class="muted" style="margin-top:6px;"></p>
</div>
  <!-- Uploaded Video Preview -->
<div id="videoPreview" style="display:none; margin-top:10px; text-align:center;">
  <h4>Uploaded Clip Preview:</h4>
  <video id="previewPlayer" controls width="320" height="240" style="border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.2);"></video>
</div>
  
</div> <!-- end #dashboard -->

<script>
/* ==========================  BK FRONTEND – SINGLE SCRIPT  ========================== */
/* Paste this whole block between <script> … </script>. Keep only ONE copy in the page. */

/* ---------- Tiny helper ---------- */
const $ = (sel) => document.querySelector(sel);

/* ---------- DEV: catch duplicate IDs quickly (safe to keep in prod) ---------- */
(function devIdCheck(){
  const counts = {};
  document.querySelectorAll('[id]').forEach(n => counts[n.id]=(counts[n.id]||0)+1);
  const dups = Object.entries(counts).filter(([_,c])=>c>1);
  if (dups.length) console.warn('[BK] Duplicate IDs found:', dups);
})();

/* ---------- Config ---------- */
const BASE = (location.hostname.endsWith('github.io') || location.hostname.includes('vercel.app'))
  ? 'https://ai-soccer-backend-2-production.up.railway.app'
  : ''; // same-origin when you host frontend + backend together

// Cloudinary (for direct uploads)
const CLOUD_NAME     = 'dblconpx8';                 // <-- keep yours
const UPLOAD_PRESET  = 'ballknowledge_unsigned';    // <-- keep yours

/* ---------- Cached Elements (guarded; ok if missing) ---------- */
// HERO / Auth
const usernameEl    = $('#username');
const passwordEl    = $('#password');
const loginBtn      = $('#loginBtn');
const signupBtn     = $('#signupBtn');
const logoutBtn     = $('#logoutBtn');
const authMsg       = $('#authMsg');       // optional <p id="authMsg">

// Profile
const profileCard       = $('#profileCard');
const heightEl          = $('#height');
const weightEl          = $('#weight');
const footEl            = $('#foot');
const positionEl        = $('#position');
const dobEl             = $('#dob');
const saveProfileBtn    = $('#saveProfileBtn');
const profileMsg        = $('#profileMsg'); // optional <p id="profileMsg">

// Players
const nameEl        = $('#name');
const addBtn        = $('#addBtn');
const msgEl         = $('#msg');
const refreshBtn    = $('#refresh');
const listEl        = $('#list');

// Analysis (stub)
const analysisCard  = $('#analysisCard');
const analysisResult= $('#analysisResult');

// Uploads (optional)
const uploadCard    = $('#uploadCard');
const uploadBtn     = $('#uploadBtn');
const fileInput     = $('#clipFile');
const uploadMsg     = $('#uploadMsg');

// Splash
const splashEl      = $('#splash');

/* ---------- Splash hide + failsafe ---------- */
function hideSplash() {
  if (!splashEl) return;
  try { splashEl.classList.add('hide'); } catch {}
  splashEl.remove();
}
window.addEventListener('load', () => setTimeout(hideSplash, 300));  // normal path
setTimeout(hideSplash, 2000);                                        // failsafe

console.log('[BK boot] JS loaded');

/* ---------- Auth token helpers ---------- */
function setToken(t){ try{ localStorage.setItem('bk_token', t);}catch{} }
function getToken(){ try{ return localStorage.getItem('bk_token'); }catch{ return null; } }
function clearToken(){ try{ localStorage.removeItem('bk_token'); }catch{} }

/* ---------- Small API wrapper (auto Authorization) ---------- */
async function api(path, options = {}) {
  const headers = options.headers ? {...options.headers} : {};
  const tok = getToken();
  if (tok) headers['Authorization'] = `Bearer ${tok}`;
  if (!headers['Content-Type'] && options.method && options.method !== 'GET') {
    headers['Content-Type'] = 'application/json';
  }
  const res = await fetch(`${BASE}${path}`, { ...options, headers });
  let body;
  try { body = await res.json(); } catch { body = { ok:false, error:'Bad JSON'} }
  return body;
}

/* ==========================  AUTH  ========================== */
async function doSignup() {
  const username = usernameEl?.value?.trim() || '';
  const password = passwordEl?.value || '';
  if (!username || !password) return showAuth('Enter username + password', false);

  showAuth('Signing up...');
  const out = await api('/api/signup', {
    method:'POST',
    body: JSON.stringify({ username, password })
  });
  if (out.ok && out.token) {
    setToken(out.token);
    showAuth(`Welcome, ${out.user?.username || username}! ✅`, true);
    revealProfile();
  } else {
    showAuth(out.error || 'Signup failed', false);
  }
}

async function doLogin() {
  const username = usernameEl?.value?.trim() || '';
  const password = passwordEl?.value || '';
  if (!username || !password) return showAuth('Enter username + password', false);

  showAuth('Logging in...');
  const out = await api('/api/login', {
    method:'POST',
    body: JSON.stringify({ username, password })
  });
  if (out.ok && out.token) {
    setToken(out.token);
    showAuth(`Welcome, ${out.user?.username || username}! ✅`, true);
    revealProfile();
  } else {
    showAuth(out.error || 'Login failed', false);
  }
}

function doLogout(){
  clearToken();
  showAuth('Logged out', true);
  // (optional) hide profile card after logout
  if (profileCard) profileCard.style.display = 'none';
}

function showAuth(msg, ok=true){
  if (!authMsg) return;
  authMsg.textContent = msg;
  authMsg.style.opacity = '1';
  authMsg.style.color = ok ? '#aefcc5' : '#ff9a9a';
  setTimeout(()=>{ authMsg.style.opacity = '0.75'; }, 1200);
}

/* ==========================  PROFILE  ========================== */
async function saveProfile() {
  const payload = {
    height:   heightEl?.value?.trim() || '',
    weight:   weightEl?.value?.trim() || '',
    foot:     footEl?.value?.trim() || '',
    position: positionEl?.value?.trim() || '',
    dob:      dobEl?.value?.trim() || ''
  };

  const out = await api('/api/profile', {
    method:'POST',
    body: JSON.stringify(payload)
  });

  const ok = !!out.ok;
  if (profileMsg) {
    profileMsg.textContent = ok ? 'Profile saved ✅' : (out.error || 'Profile save failed');
    profileMsg.style.color = ok ? '#aefcc5' : '#ff9a9a';
  }
  return out;
}

function revealProfile(){
  if (profileCard) profileCard.style.display = 'block';
}

/* ==========================  PLAYERS  ========================== */
async function addPlayer() {
  const name = nameEl?.value?.trim();
  if (!name) return showMsg('Enter a player name', false);
  showMsg('Adding player…');
  const out = await api('/api/player', {
    method:'POST',
    body: JSON.stringify({ name })
  });
  if (out.ok) {
    nameEl.value = '';
    await refresh();
    showMsg(`Added "${name}" ✅`, true);
    // optional: renderAnalysis(name);
    if (analysisCard) analysisCard.style.display = 'block';
    if (uploadCard) uploadCard.style.display = 'block';
  } else {
    showMsg(out.error || 'Could not add player', false);
  }
}

async function refresh() {
  if (!listEl) return;
  listEl.innerHTML = '<li class="muted">Loading…</li>';
  try {
    const out = await api('/api/players', { cache:'no-store' });
    const players = out.players || [];
    if (!players.length) {
      listEl.innerHTML = '<li class="muted">No players yet.</li>';
      return;
    }
    listEl.innerHTML = '';
    players.forEach(p=>{
      const li = document.createElement('li');
      // supports either string or object from backend
      const name = typeof p === 'string' ? p : (p.name || '');
      li.textContent = name || String(p);
      li.style.cursor = 'pointer';
      li.onclick = () => {
        // Optional future hooks:
        // loadProfile(name); renderAnalysis(name);
        if (analysisCard) analysisCard.style.display = 'block';
        if (uploadCard) uploadCard.style.display = 'block';
      };
      listEl.appendChild(li);
    });
  } catch (e) {
    console.error('[BK] refresh error', e);
    listEl.innerHTML = '<li class="error">Failed to load players. Server may be offline.</li>';
  }
}

function showMsg(m, ok=true){
  if (!msgEl) return;
  msgEl.textContent = m;
  msgEl.style.color = ok ? '#aefcc5' : '#ff9a9a';
}

/* ==========================  ANALYSIS (stub)  ========================== */
// Fill this later once your analysis endpoint is ready.
async function renderAnalysis(name) {
  if (!analysisResult) return;
  analysisResult.innerHTML = `
    <div class="muted">AI report placeholder for <b>${name}</b>…</div>
  `;
}

/* ==========================  CLOUDINARY UPLOAD (optional)  ========================== */
/* Requires: <input id="clipFile" type="file" accept="video/*"> and <button id="uploadBtn">Upload</button> */
async function uploadToCloudinary(file){
  const url = `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/auto/upload`;
  const fd = new FormData();
  fd.append('file', file);
  fd.append('upload_preset', UPLOAD_PRESET);
  // (optional) fd.append('folder', 'ballknowledge');
  const res = await fetch(url, { method:'POST', body: fd });
  return res.json(); // { secure_url, public_id, ... }
}

/* ==========================  WIRING  ========================== */
if (signupBtn)  signupBtn.onclick  = doSignup;
if (loginBtn)   loginBtn.onclick   = doLogin;
if (logoutBtn)  logoutBtn.onclick  = doLogout;

if (saveProfileBtn) saveProfileBtn.onclick = saveProfile;

if (addBtn)     addBtn.onclick     = addPlayer;
if (refreshBtn) refreshBtn.onclick = refresh;

// Upload button (optional – direct to Cloudinary)
if (uploadBtn && fileInput) {
  uploadBtn.onclick = async () => {
    const f = fileInput.files?.[0];
    if (!f) { if (uploadMsg) uploadMsg.textContent = 'Choose a video first'; return; }
    if (uploadMsg) uploadMsg.textContent = 'Uploading…';
    try {
      const up = await uploadToCloudinary(f);
      if (up.secure_url) {
        if (uploadMsg) uploadMsg.textContent = 'Uploaded ✅';
        // TODO: call your backend to attach this clip to the current user/player if desired
        // await api('/api/clip', { method:'POST', body: JSON.stringify({ url: up.secure_url, public_id: up.public_id }) });
      } else {
        if (uploadMsg) uploadMsg.textContent = 'Upload failed';
      }
    } catch (e) {
      console.error('[BK] cloudinary error', e);
      if (uploadMsg) uploadMsg.textContent = 'Network error';
    }
  };
}

/* Initial load */
refresh();

// If already logged in (token in storage), show profile card automatically
try { if (getToken() && profileCard) profileCard.style.display = 'block'; } catch {}

/* ==========================  END  ========================== */
</script>
