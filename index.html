<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SkillzWithSyd – Prototype</title>
  
  <!-- Social & preview metadata -->
<meta name="theme-color" content="#0f0f0f" />
<meta property="og:type" content="website" />
<meta property="og:title" content="Ball Knowledge – AI Soccer Prototype" />
<meta property="og:description" content="Add players and preview AI-style analysis. Built by Ball Knowledge." />
<meta property="og:image" content="ball-knowledge-high-resolution-logo.png" />
<meta property="og:url" content="https://smusoni.github.io/ai-soccer-frontend/" />
<meta name="twitter:card" content="summary_large_image" />
  
  <!-- Favicon -->
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="site.webmanifest">

 <style>
  body {
    font-family: "Poppins", Arial, sans-serif;
    background: #0f0f0f;
    color: #fff;
    margin: 24px;
    max-width: 720px;
    line-height: 1.6;
  }
  h1 {
    margin: 10px 0;
    font-size: 2rem;
    color: #00ff88;
    text-shadow: 0 0 8px rgba(0, 255, 136, 0.5);
  }
  .card {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 12px;
    padding: 16px;
    margin: 12px 0;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
  }
  input, button {
    padding: 10px 12px;
    font-size: 16px;
    border-radius: 8px;
  }
  input {
    border: 1px solid rgba(255,255,255,0.2);
    background: rgba(255,255,255,0.1);
    color: #fff;
  }
  button {
    border: none;
    background: linear-gradient(90deg, #00aaff, #00ff88);
    color: #fff;
    cursor: pointer;
    transition: opacity 0.3s ease;
  }
  button:hover { opacity: 0.8; }
  ul { padding-left: 20px; }
  .row { display: flex; gap: 8px; }
  .muted { color: #aaa; font-size: 14px; }
  #msg { margin-top: 8px; }
  .error { color: #ff5555; }
  .ok { color: #00ff88; }
  img.logo {
    width: 180px;
    margin-bottom: 10px;
  }
   /* --- Splash / Intro --- */
#splash {
  position: fixed; inset: 0; z-index: 9999;
  display: flex; flex-direction: column; gap: 16px;
  align-items: center; justify-content: center;
  background: #0f0f0f;
}

#splash .logo {
  width: 160px; height: auto; opacity: 0.95;
}

#splash h1 {
  margin: 8px 0 0; font-size: 2.2rem; color: #00ff88;
  text-shadow: 0 0 12px rgba(0,255,136,0.55);
}

#splash p { color: #aaa; margin: 0; }

.spinner {
  width: 44px; height: 44px; border-radius: 50%;
  border: 3px solid rgba(255,255,255,0.15);
  border-top-color: #00aaff;
  animation: spin 0.9s linear infinite;
}

@keyframes spin { to { transform: rotate(360deg); } }

#splash.hide { animation: fadeout 500ms ease forwards; }
@keyframes fadeout { to { opacity: 0; visibility: hidden; } }
  .analysisBox {
  background: #111;
  border-radius: 10px;
  padding: 14px 18px;
  margin-top: 10px;
  line-height: 1.5;
  color: #eee;
  box-shadow: 0 0 15px rgba(0,255,100,0.15);
}

.analysisBox strong {
  color: #00ff99;
}
 
</style>

</head>
<body>
  <!-- Intro / Splash -->
<div id="splash">
  <img src="ball-knowledge-high-resolution-logo.png" alt="Ball Knowledge Logo" class="logo" />
  <h1>Ball Knowledge</h1>
  <p>Initializing AI… connecting to server</p>
  <div class="spinner"></div>
</div>

  <img src="ball-knowledge-high-resolution-logo.png" alt="Ball Knowledge Logo" class="logo">
<h1>Ball Knowledge</h1>
<p class="muted">Analyze. Learn. Evolve.</p>
  
  <div class="card">
    <h3>Add player</h3>
    <div class="row">
      <input id="name" placeholder="Player name" />
      <button id="addBtn">Add</button>
    </div>
    <div id="msg"></div>
  </div>

  <div class="card">
    <h3>Players</h3>
    <button id="refresh">Refresh list</button>
    <ul id="list"></ul>
  </div>
  <!-- Analysis Card -->
<div class="card" id="analysisCard" style="display:none">
  <h3>AI Analysis</h3>
  <p class="muted">Performance breakdown & recommendations.</p>

  <div id="analysisResult" class="analysisBox">
    <p class="muted">Select a player to view their AI analysis.</p>
  </div>

  <button id="refreshAnalysis" style="margin-top:12px">Re-run Analysis</button>
</div>
  <!-- Attributes Card -->
<div class="card" id="attrCard" style="display:none;">
  <h3>Attributes</h3>
  <p class="muted">Adjust your current self-rating (0–100). Saved on this device for now.</p>

  <label>Pace <input type="range" id="attrPace" min="0" max="100" value="60" oninput="attrPaceVal.textContent=this.value"> <strong id="attrPaceVal">60</strong></label><br>
  <label>Technique <input type="range" id="attrTech" min="0" max="100" value="60" oninput="attrTechVal.textContent=this.value"> <strong id="attrTechVal">60</strong></label><br>
  <label>Awareness <input type="range" id="attrAware" min="0" max="100" value="60" oninput="attrAwareVal.textContent=this.value"> <strong id="attrAwareVal">60</strong></label><br>
  <label>Composure <input type="range" id="attrComp" min="0" max="100" value="60" oninput="attrCompVal.textContent=this.value"> <strong id="attrCompVal">60</strong></label><br>

  <button id="saveAttrs" style="margin-top:10px">Save attributes</button>
  <p id="attrMsg" class="muted" style="margin-top:6px"></p>
</div>
  <!-- Clips Card -->
<div class="card" id="clipsCard" style="display:none;">
  <h3>Clips</h3>
  <p class="muted">Uploaded clips for the selected player.</p>
  <ul id="clipList"></ul>
</div>
  <!-- === Upload Video Clip === -->
<div class="row" style="margin-top:12px">
  <input id="clipFile" type="file" accept="video/*" />
  <button id="uploadBtn">Upload clip</button>
</div>
<p id="uploadMsg" class="muted" style="margin-top:6px"></p>
<!-- Optional video preview -->
<div id="videoPreview" style="display:none; margin-top:10px;">
  <h4>Uploaded Clip Preview:</h4>
  <video id="previewPlayer" controls width="320"></video>
</div>
  <!-- Upload Footage Card -->
<div class="card" id="uploadCard">
  <h3>Upload Player Footage</h3>
  <p class="muted">Upload a short clip (max 60s). Accepted formats: MP4, MOV, WEBM.</p>
  <input type="file" id="fileInput" accept="video/*,image/*">
  <button id="uploadBtn">Upload</button>
  <p id="uploadMsg" class="muted"></p>
</div>
  <!-- Upload Player Clip -->
<div class="card" id="uploadCard" style="display:none; margin-top:12px;">
  <h3>Upload Player Clip</h3>
  <input id="clipFile" type="file" accept="video/*" />
  <button id="uploadBtn">Upload clip</button>
  <p id="uploadMsg" class="muted" style="margin-top:6px;"></p>
</div>
  <!-- Uploaded Video Preview -->
<div id="videoPreview" style="display:none; margin-top:10px; text-align:center;">
  <h4>Uploaded Clip Preview:</h4>
  <video id="previewPlayer" controls width="320" height="240" style="border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.2);"></video>
</div>

<script>
// ====== CONFIG ======
const BASE = "https://ai-soccer-backend-2-production.up.railway.app";
const CLOUD_NAME = "dblconpx8";
const UPLOAD_PRESET = "ballknowledge_unsigned";
const uploadBtn = document.getElementById('uploadBtn');
const fileInput = document.getElementById('clipFile');
const uploadMsg = document.getElementById('uploadMsg');

(function () {
  // ====== NUKE THE SPLASH (robust) ======
  function killSplash() {
    const s = document.getElementById('splash');
    if (s) { s.classList.add('hide'); setTimeout(() => s.remove(), 400); }
  }
  window.addEventListener('load', () => setTimeout(killSplash, 800));
  document.addEventListener('DOMContentLoaded', () => setTimeout(killSplash, 1600));
  setTimeout(killSplash, 4000); // last resort

  // ====== BOOT ON DOM READY ======
  document.addEventListener('DOMContentLoaded', () => {
    const $ = id => document.getElementById(id);

    // Elements
    const nameEl = $('name');
    const addBtn = $('addBtn');
    const msgEl = $('msg');
    const refreshBtn = $('refresh');
    const listEl = $('list');
    const analysisCard = $('analysisCard');
    const analysisResult = $('analysisResult');

    const attrCard = $('attrCard');
    const uploadCard = $('uploadCard');
    const uploadBtn = $('uploadBtn');
    const fileInput = $('clipFile');
    const uploadMsg = $('uploadMsg');
    const videoPreview = $('videoPreview');
    const previewPlayer = $('previewPlayer');

    let currentPlayer = null;

    // Helpers
    const showMsg = (text, ok = true) => {
      if (!msgEl) return;
      msgEl.textContent = text;
      msgEl.className = ok ? 'ok' : 'error';
    };

    // Analysis (mock)
    async function renderAnalysis(playerName) {
      if (!analysisCard || !analysisResult) return;
      analysisCard.style.display = 'block';
      analysisResult.innerHTML = `<p class="muted">Analyzing <strong>${playerName}</strong>…</p>`;
      await new Promise(r => setTimeout(r, 900));
      const rows = [
        ['Top Skill','Speed & Awareness'],
        ['Needs Work','Composure under pressure'],
        ['Suggested Drill','Small-space reaction training'],
        ['Pro Comparison','Similar to Leroy Sané']
      ];
      analysisResult.innerHTML = rows.map(([k,v]) => `<p><strong>${k}:</strong> ${v}</p>`).join('');
    }
    
    // Refresh list (robust)
async function refresh() {
  try {
    if (listEl) listEl.innerHTML = '<li class="muted">Loading…</li>';

    // add a cache-buster & explicit no-store
    const url = `${BASE}/api/players?t=${Date.now()}`;
    const res = await fetch(url, { cache: 'no-store' });

    if (!res.ok) {
      throw new Error(`HTTP ${res.status} ${res.statusText}`);
    }

    // Handle both {players: [...] } and just [...]
    const data = await res.json();
    const players = Array.isArray(data) ? data : (data.players || []);

    if (!listEl) return;
    listEl.innerHTML = '';

    if (!players.length) {
      listEl.innerHTML = '<li class="muted">No players yet.</li>';
      return;
    }

    players.forEach(p => {
      const name = typeof p === 'string' ? p : (p.name || '');
      const rating = typeof p === 'string' ? 'N/A' : (p.rating ?? 'N/A');

      const li = document.createElement('li');
      li.textContent = `${name} – ⚡ Rating: ${rating}`;
      li.style.cursor = 'pointer';

      li.onclick = () => {
        if (!name) return;
        // your existing function that loads attrs & clips and then calls renderAnalysis
        loadProfile(name);
      };

      listEl.appendChild(li);
    });
  } catch (err) {
    console.error('[BallKnowledge] refresh error:', err);
    if (listEl) {
      listEl.innerHTML =
        '<li class="error">⚠️ Failed to load players. Server may be offline.</li>';
    }
  }
}
    // Add player
    if (addBtn) {
      addBtn.onclick = async () => {
        const name = (nameEl?.value || '').trim();
        if (!name) return showMsg('Enter a name', false);
        try {
          const res = await fetch(`${BASE}/api/player`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name })
          });
          const data = await res.json();
          if (data.ok) {
            showMsg(`Added ${name} ✅`, true);
            if (nameEl) nameEl.value = '';
            await refresh();
            await loadprofile(name);
            currentPlayer = name;
            renderAnalysis(name);
          } else {
            showMsg(data.error || 'Could not add player', false);
          }
        } catch (e) {
          console.error('[BK] add error', e);
          showMsg('Network error', false);
        }
      };
    }

    if (refreshBtn) refreshBtn.onclick = refresh;
    refresh(); // initial load

    // ====== CLOUDINARY UPLOAD (direct) ======
    if (uploadBtn && fileInput) {
      uploadBtn.onclick = async () => {
        const file = fileInput.files?.[0];
        if (!currentPlayer) { if (uploadMsg) uploadMsg.textContent = 'Pick a player first.'; return; }
        if (!file) { if (uploadMsg) uploadMsg.textContent = 'Choose a video first.'; return; }

        if (uploadMsg) uploadMsg.textContent = 'Uploading…';
        try {
          const fd = new FormData();
          fd.append('file', file);
          fd.append('upload_preset', UPLOAD_PRESET);

          const up = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/upload`, {
            method: 'POST',
            body: fd
          });
          const j = await up.json();
          if (j.secure_url) {
            if (uploadMsg) uploadMsg.textContent = '✅ Upload complete!';
            if (previewPlayer && videoPreview) {
              previewPlayer.src = j.secure_url;
              videoPreview.style.display = 'block';
            }
          } else {
            if (uploadMsg) uploadMsg.textContent = 'Upload failed.';
            console.error('[BK] cloudinary error', j);
          }
        } catch (e) {
          console.error('[BK] upload error', e);
          if (uploadMsg) uploadMsg.textContent = 'Network error.';
        }
      };
    }
  });
})();
  // ================== PROFILE HELPERS ==================
function setAttrUI(attrs = {}) {
  const set = (id, v) => {
    const el = document.getElementById(id);
    if (el) el.value = Number(v ?? 0);
  };
  set('attrPace',  attrs.pace);
  set('attrTech',  attrs.tech);
  set('attrAware', attrs.aware);
  set('attrComp',  attrs.comp);
}

function showClips(clips = []) {
  const card = document.getElementById('clipsCard');
  const ul   = document.getElementById('clipList');
  if (!ul) return;

  ul.innerHTML = '';
  if (!clips.length) {
    ul.innerHTML = '<li class="muted">No clips yet.</li>';
  } else {
    clips.forEach(c => {
      const li = document.createElement('li');
      const when = c.created_at ? new Date(c.created_at).toLocaleDateString() : '';
      li.innerHTML = `<a href="${c.url}" target="_blank" rel="noopener">${c.public_id || 'clip'}</a> <span class="muted">${when}</span>`;
      ul.appendChild(li);
    });
  }
  if (card) card.style.display = 'block';
}

async function loadProfile(name) {
  try {
    showMsg(`Loading ${name}…`, true);
    const res = await fetch(`${BASE}/api/player/${encodeURIComponent(name)}`, { cache: 'no-store' });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json(); // { ok, player: { name, attrs, clips } }

    if (!data || !data.player) {
      showMsg('Player not found', false);
      return;
    }

    // keep full player object
    currentPlayer = data.player;

    // fill sliders
    if (currentPlayer.attrs) setAttrUI(currentPlayer.attrs);

    // show clips
    showClips(currentPlayer.clips || []);

    // reveal cards + render analysis
    try { renderAnalysis(currentPlayer); } catch {}
    if (typeof analysisCard !== 'undefined' && analysisCard) analysisCard.style.display = 'block';
    if (typeof attrCard !== 'undefined' && attrCard)       attrCard.style.display       = 'block';

    showMsg(`Loaded ${currentPlayer.name}`, true);
  } catch (e) {
    console.error('[BK] loadProfile error', e);
    showMsg('Could not load profile', false);
  }
}
  (function () {
  const btn = document.getElementById('saveAttrs');
  if (!btn) return;

 uploadBtn.onclick = async () => {
  // You must click a player in the list first (that sets currentPlayer)
  if (!currentPlayer || !currentPlayer.name) {
    return showMsg('Pick a player first', false);
  }

  // Make sure a file is chosen
  const f = fileInput?.files?.[0];
  if (!f) return showMsg('Choose a video file', false);

  if (uploadMsg) uploadMsg.textContent = 'Uploading…';

  try {
    // 1) Upload to Cloudinary (unsigned)
    const form = new FormData();
    form.append('file', f);
    form.append('upload_preset', UPLOAD_PRESET);

    const cloudRes = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/auto/upload`, {
      method: 'POST',
      body: form
    });
    const j = await cloudRes.json();
    if (j.error) throw new Error(j.error?.message || 'Cloudinary error');

    // Helpful log while testing
    console.log('[BK] cloudinary uploaded', j.secure_url);

    // 2) Tell backend to attach this clip to the player
    const saveRes = await fetch(`${BASE}/api/player/${encodeURIComponent(currentPlayer.name)}/clips`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      // server.js expects: { url, public_id, created_at }
      body: JSON.stringify({
        url: j.secure_url,
        public_id: j.public_id,
        created_at: j.created_at || Date.now()
      }),
      cache: 'no-store'
    });

    if (!saveRes.ok) {
      const t = await saveRes.text();
      throw new Error(`Backend save failed: ${t}`);
    }

    if (uploadMsg) uploadMsg.textContent = 'Uploaded ✅';

    // 3) Reload profile so the clip appears in UI
    await loadProfile(currentPlayer.name);

  } catch (e) {
    console.error('[BK] upload flow error', e);
    if (uploadMsg) uploadMsg.textContent = 'Upload failed';
    showMsg('Upload failed', false);
  }
};
 
  // ================== HOOK REFRESH + FIRST LOAD ==================
  if (refreshBtn) refreshBtn.onclick = refresh;
  refresh();
  }
</script>

</body>
</html>
